generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Computer {
  id          String   @id @default(cuid())
  hostname    String   @unique
  ipAddress   String
  macAddress  String?
  osVersion   String?
  department  String   @default("General")
  label       String?
  tags        String   @default("")
  apiKey      String
  lastSeenAt  DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  reports     Report[]
  alerts      Alert[]
  messages    Message[]
  commands    Command[]
}

model Report {
  id          String   @id @default(cuid())
  computerId  String
  computer    Computer @relation(fields: [computerId], references: [id], onDelete: Cascade)

  cpuUsage    Float
  cpuCores    Int?
  cpuSpeed    String?
  cpuTemp     Float?

  ramTotal    Float
  ramUsed     Float
  ramUsage    Float

  diskTotal   Float
  diskUsed    Float
  diskUsage   Float
  diskDetails String?

  networkUp   Boolean  @default(true)
  networkInfo String?

  osInfo      String?
  uptime      Float?

  topProcesses String?
  eventLogs    String?
  software     String?
  antivirusStatus String?

  printers        String?
  windowsLicense  String?
  officeLicense   String?
  startupPrograms String?
  sharedFolders   String?
  usbDevices      String?
  windowsUpdate   String?
  services        String?

  createdAt   DateTime @default(now())

  @@index([computerId, createdAt])
}

model Message {
  id          String   @id @default(cuid())
  computerId  String?
  computer    Computer? @relation(fields: [computerId], references: [id], onDelete: Cascade)

  hostname    String
  department  String?
  ipAddress   String?
  message     String
  read        Boolean  @default(false)
  readAt      DateTime?
  resolved    Boolean  @default(false)
  resolvedAt  DateTime?
  reply       String?

  createdAt   DateTime @default(now())

  @@index([read])
  @@index([resolved])
  @@index([createdAt])
}

model Command {
  id          String   @id @default(cuid())
  computerId  String
  computer    Computer @relation(fields: [computerId], references: [id], onDelete: Cascade)

  action      String
  params      String?
  status      String   @default("pending")
  result      String?
  createdBy   String   @default("admin")

  createdAt   DateTime @default(now())
  executedAt  DateTime?

  @@index([computerId, status])
  @@index([status])
}

model Alert {
  id          String   @id @default(cuid())
  computerId  String
  computer    Computer @relation(fields: [computerId], references: [id], onDelete: Cascade)

  type        String
  severity    String   @default("warning")
  message     String
  resolved    Boolean  @default(false)
  resolvedAt  DateTime?

  createdAt   DateTime @default(now())

  @@index([computerId, createdAt])
  @@index([resolved])
}
